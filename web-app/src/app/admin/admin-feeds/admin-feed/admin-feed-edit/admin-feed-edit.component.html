<div class="page">
  <admin-breadcrumb [breadcrumbs]="breadcrumbs"></admin-breadcrumb>

  <div class="page-container">
    <div class="header" *ngIf="feed">
      <img class="icon" *ngIf="feed.mapStyle?.iconUrl" [src]="feed.mapStyle?.iconUrl"/>
      <span class="header__title">{{feed.title}}</span>
    </div>

    <div class="page-content">
      <div class="feed__configuration">
        <mat-accordion class="example-headers-align" [multi]="editState.originalFeed">
          <app-create-service *ngIf="!editState.originalFeed" [expanded]="step === -1" (opened)="setStep(-1)"
            (cancelled)="serviceCreationCancelled()" (serviceCreated)="serviceCreated($event)">
          </app-create-service>
          <app-choose-service-topic *ngIf="!editState.originalFeed"
            [services]="editState.availableServices" [topics]="editState.availableTopics"
            [selectedService]="editState.selectedService" [expanded]="step === 0"
            (opened)="setStep(0)" (serviceSelected)="serviceSelected($event)" (topicSelected)="topicSelected($event)"
            (noServicesExist)="noServicesExist()">
          </app-choose-service-topic>
          <app-topic-configuration [expanded]="step === 1" [showPrevious]="!editState.originalFeed" (opened)="setStep(1)" (cancelled)="setStep(0)"
            [fetchParametersSchema]="editState.selectedTopic?.paramsSchema"
            [initialFetchParameters]="editState.originalFeed?.constantParams"
            (fetchParametersChanged)="onFetchParametersChanged($event)"
            (fetchParametersAccepted)="onFetchParametersAccepted($event)">
          </app-topic-configuration>
          <app-feed-item-properties-configuration [expanded]="step === 2" (opened)="setStep(2)" (cancelled)="setStep(1)"
            [itemPropertiesSchema]="editState.itemPropertiesSchema"
            (itemPropertiesSchemaChanged)="onItemPropertiesSchemaChanged($event)"
            (itemPropertiesSchemaAccepted)="onItemPropertiesSchemaAccepted($event)">
          </app-feed-item-properties-configuration>
          <app-feed-configuration [expanded]="step === 3" [buttonText]="feed ? 'Update Feed' : 'Create Feed'"
            [itemPropertiesSchema]="editState.itemPropertiesSchema"
            [feedMetaData]="editState.feedMetaData"
            (opened)="setStep(3)" (cancelled)="setStep(2)"
            (feedMetaDataChanged)="onFeedMetaDataChanged($event)"
            (feedMetaDataAccepted)="onFeedMetaDataAccepted($event)">
          </app-feed-configuration>
        </mat-accordion>
      </div>
      <div class="feed__preview">
        <div *ngIf="preview else elseBlockPreview">
          <div class="preview--list">
            <mat-nav-list>
              <div *ngFor="let feature of preview?.content?.items?.features | slice:0:10">
                <feed-item-summary [item]="feature" [feed]="preview.feed"></feed-item-summary>
                <mat-divider></mat-divider>
              </div>
            </mat-nav-list>
          </div>
        </div>
        <ng-template #elseBlockPreview>
          <div class="preview--empty">
            <i class="material-icons preview__img--empty">list</i>
            <span class="preview__span--empty">Feed Preview</span>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
